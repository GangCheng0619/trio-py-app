language: python
python:
  - 3.5.0
  - 3.5.2
  - 3.6
sudo: false

before_install:
  - pip install -Ur test-requirements.txt
  - pip install codecov

install:
  - python setup.py sdist --formats=zip
  - pip install dist/*.zip

script:
  - mkdir empty
  - cd empty
  - INSTALLDIR=$(python -c "import os, trio; print(os.path.dirname(trio.__file__))")
  - pytest -ra --pyargs trio --cov="$INSTALLDIR" --cov-config=../.coveragerc

after_success:
  - codecov
